(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{272:function(t,a,e){"use strict";e.r(a);var s=e(4),n=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"bundle-size-hunting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bundle-size-hunting","aria-hidden":"true"}},[t._v("#")]),t._v(" Bundle size hunting ‚úÇÔ∏è")]),t._v(" "),e("blockquote",[e("p",[t._v("To start this exercise, be sure to be in "),e("code",[t._v("./packages/intermediate/reduce-bundle-size")]),t._v(" folder.\nBe sure you have "),e("router-link",{attrs:{to:"/workshops/#install"}},[t._v("installed this repository first")])],1)]),t._v(" "),e("h2",{attrs:{id:"introduction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#introduction","aria-hidden":"true"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),e("p",[t._v('Having a tool like webpack to generate code "bundles" is great to let it handle code dependencies.\nHowever it would be quite difficult to keep those generate bundle under a critic size.')]),t._v(" "),e("p",[t._v("Main causes are:")]),t._v(" "),e("ul",[e("li",[t._v("Your app contains a huge quantity of code")]),t._v(" "),e("li",[t._v("You import huge dependencies")]),t._v(" "),e("li",[t._v("You are generating too few bundles. Your browser need to load and parse a huge file before rendering your all app.")])]),t._v(" "),e("h2",{attrs:{id:"example-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#example-app","aria-hidden":"true"}},[t._v("#")]),t._v(" Example App")]),t._v(" "),e("p",[t._v("This is a really simple pokedex app made with vuejs.\nIn order to simplify build configuration, we won't use "),e("code",[t._v("vue-loader")]),t._v(" here.\nThe app have two pages :")]),t._v(" "),e("ul",[e("li",[t._v("home page displaying 20 pokemons")]),t._v(" "),e("li",[t._v("pokemon detail page with a specific image.")])]),t._v(" "),e("p",[t._v("You can start this application with:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("yarn start\n")])])]),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("When you start your server, you will notice webpack warnings in the console.\nWebpack is trying to tell you that your app bundle is too fat.")]),t._v(" "),e("p",[t._v("Let's try to fix that ! üòâ")])]),t._v(" "),e("h2",{attrs:{id:"analysing-bundle-size-and-content"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#analysing-bundle-size-and-content","aria-hidden":"true"}},[t._v("#")]),t._v(" Analysing bundle size and content")]),t._v(" "),e("p",[t._v("First thing, let's try to focus on what is in our bundle and you will see it is too fat.")]),t._v(" "),e("p",[t._v("We will use "),e("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack Bundle Analyser"),e("OutboundLink")],1)]),t._v(" "),e("details",[e("summary",[t._v("Solution")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" BundleAnalyzerPlugin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack-bundle-analyzer"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BundleAnalyzerPlugin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BundleAnalyzerPlugin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),e("p",[t._v("You should normally see a lonely bundle containing:")]),t._v(" "),e("ul",[e("li",[t._v("all bulma code")]),t._v(" "),e("li",[t._v("all lodash lib")]),t._v(" "),e("li",[t._v("vue js")]),t._v(" "),e("li",[t._v("all your app code")])]),t._v(" "),e("h2",{attrs:{id:"tree-shaking-your-code"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking-your-code","aria-hidden":"true"}},[t._v("#")]),t._v(" Tree shaking your code")]),t._v(" "),e("p",[t._v("Let's try to cut tree by the big branches first: the dependencies.")]),t._v(" "),e("p",[t._v("We are importing all bulma code, let's try to reduce bundle size by importing only whta is needed:")]),t._v(" "),e("ul",[e("li",[t._v("columns")]),t._v(" "),e("li",[t._v("headings")]),t._v(" "),e("li",[t._v("card")])]),t._v(" "),e("details",[e("summary",[t._v("Solution")]),t._v(" "),e("p",[t._v("Create a file "),e("code",[t._v("app.sass")]),t._v(" and only load bulma parts.")]),t._v(" "),e("div",{staticClass:"language-sass extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sass"}},[e("code",[e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@charset")]),t._v(' "utf-8"')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@import")]),t._v(' "~bulma/sass/utilities/_all.sass"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@import")]),t._v(' "~bulma/sass/base/_all.sass"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@import")]),t._v(' "~bulma/sass/components/card.sass"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@import")]),t._v(' "~bulma/sass/elements/title.sass"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token atrule-line"}},[e("span",{pre:!0,attrs:{class:"token atrule"}},[t._v("@import")]),t._v(' "~bulma/sass/grid/columns.sass"')]),t._v("\n")])])])]),t._v(" "),e("p",[t._v("Let's try to load just one function of lodash instead of all the lib")]),t._v(" "),e("details",[e("summary",[t._v("Solution")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _capitalize "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash/capitalize"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("For lodash you could also use "),e("a",{attrs:{href:"https://github.com/lodash/babel-plugin-lodash",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel plugin lodash"),e("OutboundLink")],1),t._v(" if your are using babel in your app.")])]),t._v(" "),e("h2",{attrs:{id:"code-splitting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#code-splitting","aria-hidden":"true"}},[t._v("#")]),t._v(" Code splitting")]),t._v(" "),e("p",[t._v("Now the app is loading only the dependencies we need.\nLet's try to load only home page code on home page ! üòÑ")]),t._v(" "),e("p",[t._v("To do so we will need to generate two bundles: one for home, and one for details page.")]),t._v(" "),e("p",[t._v("We could do that by adding another entry in Webpack configuration "),e("strong",[t._v("OR")]),t._v(" we could use webpack dynamic imports.")]),t._v(" "),e("p",[t._v("VueJS is ok by default with async component üéâ , let's try to import our page in router with dynamic import.")]),t._v(" "),e("p",[t._v("It will generate 1 bundle for each page.")]),t._v(" "),e("details",[e("summary",[t._v("Solution")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Router "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue-router"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nVue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Router"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  routes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./pages/home"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/details/:id"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      component"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./pages/details"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      props"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),e("h2",{attrs:{id:"name-your-chunks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#name-your-chunks","aria-hidden":"true"}},[t._v("#")]),t._v(" Name your chunks !")]),t._v(" "),e("p",[t._v("Ok the two "),e("code",[t._v("chunk")]),t._v(" contains your page code and that's great.\nYou could try to load your app, the browser will only load the JS you need to display the page.")]),t._v(" "),e("p",[t._v("Maybe we could name those chunk to help us understand what we just split.")]),t._v(" "),e("ol",[e("li",[t._v("Change the output filename config to "),e("code",[t._v("[name].bundle.js")])]),t._v(" "),e("li",[t._v("Add a comment in the dynamic import to name your chunk ("),e("code",[t._v('import(/* webpackChunkName: "home" */ "./pages/home")')]),t._v(")")])]),t._v(" "),e("h2",{attrs:{id:"prefetch-your-bundles"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prefetch-your-bundles","aria-hidden":"true"}},[t._v("#")]),t._v(" Prefetch your bundles !")]),t._v(" "),e("p",[t._v("You can also tell your browser, ok you don't need that bundle for now, but try to prefetch it if you have time, it is good for you.\nThis could be done with another webpack comment, look at "),e("a",{attrs:{href:"https://webpack.js.org/guides/code-splitting/#prefetchingpreloading-modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("related doc"),e("OutboundLink")],1)])])},[],!1,null,null,null);a.default=n.exports}}]);